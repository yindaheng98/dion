syntax = "proto3";

import "github.com/pion/ion/proto/ion/ion.proto";
import "google/protobuf/any.proto";

option go_package = "github.com/yindaheng98/isglb/proto";

package islb;

service ISGLB {
  // When forward path changed, upload the SFUStatus from client to ISGLB
  // When forward path should change, send expected SFUStatus from ISGLB to client
  rpc SyncSFUStatus(stream SFUStatus) returns (stream SFUStatus) {}

  // Report the communication quality of the edge
  rpc EdgeQualityReport(stream EdgeReport) returns (stream ReportReply) {}

  // Report the computation quality of the node
  rpc NodeQualityReport(stream NodeReport) returns (stream ReportReply) {}
}

// The track with id `srcTrackId` from `src` node was/should forwarded and output track's name is `dstTrackId`
message ForwardTrack {
  ion.Node src = 1;
  string srcTrackId = 2;
  string dstTrackId = 3;
}

// The track with id `srcTrackId` in the current node was/should proceeded and output track's name is `dstTrackId`
message ProceedTrack {
  string srcTrackId = 1;
  string dstTrackId = 2;
}

message SFUStatus {
  ion.Node SFU = 1;
  repeated ForwardTrack forwardTracks = 2;
  repeated ProceedTrack proceedTracks = 3;
}

message EdgeReport {
  ion.Node src = 1;
  ion.Node dst = 2;
  google.protobuf.Any report = 3; //TODO: Add a more specific Report type
}

message NodeReport {
  ion.Node node = 1;
  google.protobuf.Any report = 2; //TODO: Add a more specific Report type
}

message ReportReply {
  bool success = 1;
  string error = 2;
}